# Run tests for all services with test scripts
echo "ğŸ§ª Running tests before push..."

# Array to track failed services
failed_services=""

# Test only services with actual test files
# Currently only web-portal has tests implemented
for service in web-portal; do
  echo "\nğŸ“¦ Testing $service..."
  if yarn workspace $service test; then
    echo "âœ… $service tests passed"
  else
    echo "âŒ $service tests failed"
    failed_services="$failed_services $service"
  fi
done

# Note: cashier, game-server, and game-client have test folders but no test files yet
# They will be added to this hook when tests are implemented

# Check if any service failed
if [ -n "$failed_services" ]; then
  echo "\nâŒ Tests failed in:$failed_services"
  echo "âš ï¸  Push aborted. Please fix the failing tests before pushing."
  exit 1
fi

echo "\nâœ… All tests passed! Proceeding with push..."
exit 0
